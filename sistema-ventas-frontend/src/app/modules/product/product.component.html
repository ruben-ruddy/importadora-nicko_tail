<!-- sistema-ventas-frontend/src/app/modules/product/product.component.html -->
<div class="container mx-auto px-4 py-2 bg-white">
  <h2 class="text-2xl font-bold mb-6 text-gray-800">Lista de Productos</h2> 
  <button (click)="openAddProductModal()" class="bg-green-500 text-white px-4 py-2 rounded mb-4">
    Agregar Producto
  </button>
  
  <!-- Alerta de stock bajo -->
  @if (hasLowStockProducts) {
  <div class="mb-4 p-4 bg-yellow-50 border border-yellow-200 rounded-lg">
    <div class="flex items-center">
      <svg class="w-5 h-5 text-yellow-600 mr-2" fill="currentColor" viewBox="0 0 20 20">
        <path fill-rule="evenodd" d="M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z" clip-rule="evenodd"/>
      </svg>
      <span class="text-yellow-800 font-medium">Alerta: Tienes productos con stock bajo</span>
    </div>
  </div>
  }
  
  <!-- Filtros -->
  <div class="mb-4 flex space-x-4">
    <div>
      <label class="block text-sm font-medium text-gray-700">Mostrar</label>
      <select [(ngModel)]="itemsPerPage" (change)="loadProducts()" class="mt-1 block w-full py-2 px-3 border border-gray-300 bg-white rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm text-black">
        <option value="10">10</option>
        <option value="25">25</option>
        <option value="50">50</option>
        <option value="100">100</option>
      </select>
    </div>
    
    <div>
      <label class="block text-sm font-medium text-gray-700">Estado</label>
      <select [(ngModel)]="activeFilter" (change)="loadProducts()" class="mt-1 block w-full py-2 px-3 border border-gray-300 bg-white rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm text-black">
        <option value="all">Todos</option>
        <option value="active">Activos</option>
        <option value="inactive">Inactivos</option>
      </select>
    </div>
  </div>
  
  <div class="overflow-x-auto">
    <table class="min-w-full bg-white rounded-lg overflow-hidden">
      <thead class="bg-gray-100">
        <tr>
          <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Nombre</th>
          <!-- <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Descripción</th> -->
          <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Precio Compra</th>
          <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Precio Venta</th>
          <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Categoría</th>
          <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Stock</th>
          <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Stock Mínimo</th>
          <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Estado</th>
          <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Alerta</th>
        </tr>
      </thead>
      <tbody class="divide-y divide-gray-200">
        @for (product of products?.products; track $index) {
        <tr class="hover:bg-gray-100 transition-colors" (click)="openEditProductModal(product)">
          <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">{{ product.nombre_producto }}</td>
          <!-- <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">{{ product.descripcion ? (product.descripcion.length > 30 ? product.descripcion.slice(0, 30) + '...' : product.descripcion) : 'N/A' }}</td> -->
          <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">{{ product.precio_compra }}</td>
          <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">{{ product.precio_venta }}</td>
          <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">{{ product.category.nombre_categoria }}</td>
          <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
            <span [class]="getStockStatusClass(product)">
              {{ product.stock_actual }}
            </span>
          </td>
          <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">{{ product.stock_minimo }}</td>
          <td class="px-6 py-4 whitespace-nowrap text-sm">
            <span [class]="product.activo ? 'bg-green-100 text-green-800' : 'bg-red-100 text-red-800'" class="px-2 py-1 rounded-full text-xs">
              {{ product.activo ? 'Activo' : 'Inactivo' }}
            </span>
          </td>
          <td class="px-6 py-4 whitespace-nowrap text-sm">
            @if (shouldShowStockAlert(product)) {
            <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-red-100 text-red-800 animate-pulse">
              <svg class="w-3 h-3 mr-1" fill="currentColor" viewBox="0 0 20 20">
                <path fill-rule="evenodd" d="M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z" clip-rule="evenodd"/>
              </svg>
              Stock Bajo
            </span>
            } @else if (product.stock_actual <= product.stock_minimo + 5) {
            <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-yellow-100 text-yellow-800">
              <svg class="w-3 h-3 mr-1" fill="currentColor" viewBox="0 0 20 20">
                <path fill-rule="evenodd" d="M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z" clip-rule="evenodd"/>
              </svg>
              Atención
            </span>
            } @else {
            <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800">
              <svg class="w-3 h-3 mr-1" fill="currentColor" viewBox="0 0 20 20">
                <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"/>
              </svg>
              Normal
            </span>
            }
          </td>
        </tr>
        }
      </tbody>
    </table>
  </div>
  
  <!-- Paginación -->
  <div class="mt-4 flex items-center justify-between">
    <div class="text-sm text-gray-700">
      Mostrando {{ (currentPage - 1) * itemsPerPage + 1 }} a {{ Math.min(currentPage * itemsPerPage, products?.total || 0) }} de {{ products?.total || 0 }} productos
      @if (lowStockCount > 0) {
        <span class="ml-2 text-red-600 font-medium">({{ lowStockCount }} con stock bajo)</span>
      }
    </div>
    <div class="flex space-x-2">
      <button 
        (click)="changePage(currentPage - 1)" 
        [disabled]="currentPage === 1"
        class="px-3 py-1 rounded border border-gray-300 bg-white text-gray-700 disabled:opacity-50 disabled:cursor-not-allowed">
        Anterior
      </button>
      
      <span class="px-3 py-1 border border-gray-300 bg-blue-500 text-white rounded">
        {{ currentPage }}
      </span>
      
      <button 
        (click)="changePage(currentPage + 1)" 
        [disabled]="currentPage * itemsPerPage >= (products?.total || 0)"
        class="px-3 py-1 rounded border border-gray-300 bg-white text-gray-700 disabled:opacity-50 disabled:cursor-not-allowed">
        Siguiente
      </button>
    </div>
  </div>
</div>